(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const a of t.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function r(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function s(e){if(e.ep)return;e.ep=!0;const t=r(e);fetch(e.href,t)}})();const l="tiendasdigitalessrl_gla",d="[e]Xn1Y80iq9",c="https://apis.andreani.com";console.log("API_USER:",l);console.log("API_PASSWORD:",d);console.log("API_URL:",c);async function u(){const n=btoa(`${l}:${d}`),o=`${c}/login`,r=new Headers;r.append("Authorization",`Basic ${n}`);const s={method:"GET",headers:r,redirect:"follow"};try{const e=await fetch(o,s);if(!e.ok)throw new Error(`Error al obtener el token: ${e.status} ${e.statusText}`);const t=await e.json();localStorage.setItem("authToken",t.token),console.log("Token generado:",t.token)}catch(e){console.error("Error al obtener el token:",e),alert("Error al autenticarse con la API de Andreani. Verifica tus credenciales.")}}async function p(n){const o=localStorage.getItem("authToken");if(!o){alert("No se ha obtenido el token. Inicie sesión primero.");return}const r=`${c}/envios/${n}/trazas`,s=new Headers;s.append("Authorization",`Bearer ${o}`);const e={method:"GET",headers:s,redirect:"follow"};try{const t=await fetch(r,e),a=t.headers.get("content-type");if(!t.ok)throw new Error(`Error: ${t.statusText}`);if(a&&a.includes("application/json")){const i=await t.json();f(i)}else{const i=await t.text();throw new Error(`Respuesta inesperada: ${i}`)}}catch(t){console.error("Error al obtener la traza:",t)}}function f(n){const o=document.getElementById("infonumeroAndreani");o.innerHTML="",n&&n.eventos&&n.eventos.length>0?n.eventos.forEach(r=>{const s=document.createElement("div");s.className="alert alert-info",s.innerHTML=`
                <h4 class="alert-heading">${r.Fecha}</h4>
                <p><strong>Estado:</strong> ${r.Estado||"N/A"}</p>
                <p><strong>Traducción:</strong> ${r.Traduccion||"N/A"}</p>
                <p><strong>Sucursal:</strong> ${r.Sucursal||"N/A"}</p>
                <p><strong>Ciclo:</strong> ${r.Ciclo||"N/A"}</p>
                <p><strong>Comentario:</strong> ${r.Comentario||"N/A"}</p>
            `,o.appendChild(s)}):o.innerHTML="<p>No se encontraron eventos.</p>"}document.getElementById("numeroAndreaniForm").addEventListener("submit",async function(n){n.preventDefault();const o=document.getElementById("numeroAndreani").value;o?await p(o):alert("Por favor, ingrese un número de seguimiento.")});window.addEventListener("load",u);
